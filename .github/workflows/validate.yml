---
# ============================================================================
# QUICK VALIDATION (Pre-flight Check)
# ============================================================================
# Ultra-fast syntax validation that runs on every push/PR
# Provides immediate feedback (~30 seconds) before the full CI suite runs.
#
# This catches:
#   - YAML syntax errors
#   - Missing required keys (substitutions, esphome)
#   - Invalid package references
#
# For full ESPHome compilation tests, see ci-validate-configs.yml
# ============================================================================

name: Quick Validation

on:
  push:
    branches: ["*"]
  pull_request:
    branches: ["*"]

jobs:
  quick-validate:
    name: YAML Syntax Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install validation dependencies
        run: |
          pip install pyyaml

      - name: Run validation script
        run: |
          python3 tests/validate_configs.py

      - name: Count products
        run: |
          PRODUCT_COUNT=$(find products/ -name "*.yaml" -type f ! -name "secrets.yaml" | wc -l)
          PACKAGE_COUNT=$(find packages/ -name "*.yaml" -type f | wc -l)
          echo "Products: $PRODUCT_COUNT"
          echo "Packages: $PACKAGE_COUNT"
          echo ""
          echo "For full ESPHome compilation tests, see the 'CI - Validate Firmware Configs' workflow"
